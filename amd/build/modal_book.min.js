define ("mod_lanebs/modal_book",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/modal","core/custom_interaction_events","core/modal_registry","core/str"],function(a,b,c,d,e,f,g,h,i,j){var k={CLOSE_BUTTON:"[data-action='cancel']",CONTENT_BLOCK:"[data-action='book_content_block']",CLOSE_CROSS:".close",ROOT_MODAL:"[data-region='modal-container']",CONTAINER:"[data-region='modal-container']",MODAL:"[data-region='modal']"},l=function(a){g.call(this,a);l.prototype.modal=this;if(!this.getFooter().find(k.CLOSE_BUTTON).length){f.exception({message:j.get_string("lanebs_error_close","mod_lanebs")})}};l.TYPE="mod_lanebs-book";l.CONTENT_BLOCK=k.CONTENT_BLOCK;l.prototype=Object.create(g.prototype);l.prototype.constructor=l;l.prototype.registerEventListeners=function(){g.prototype.registerEventListeners.call(this);this.getRoot().on(h.events.activate,k.CLOSE_BUTTON+", "+k.CLOSE_CROSS,function(){this.destroy();this.getBackdrop().then(function(a){a.hide()});console.log("destroy")}.bind(this));this.getModal().on(h.events.scrollBottom,k.CONTENT_BLOCK,function(a){var d=navigator.userAgent.toLowerCase(),e=!!d.match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\.browser|up\.link|webos|wos|ios)/g);e=e||1006>window.innerWidth;var f=b(a.currentTarget).attr("data-id");c.call([{methodname:"mod_lanebs_book_content",args:{id:f,mobile:e}}])[0].then(function(a){return a}).done(function(a){var c=b(k.CONTENT_BLOCK).attr("data-page"),d=b(k.CONTENT_BLOCK).attr("data-type");l.prototype.getBookResult(a.body,c,f,d)}).fail(function(a){console.log(a)})})};l.prototype.getBookResult=function(a,c,d){var e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"book",f=document.getElementById("book_iframe");b(f).attr("src","https://reader.lanbook.com/"+e+"/"+d+"?jwtToken="+a+"&mode=moodlePlugin#"+c)};i.register(l.TYPE,l,"mod_lanebs/modal_book");return l});
//# sourceMappingURL=modal_book.min.js.map
