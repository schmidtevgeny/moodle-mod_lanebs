define("mod_lanebs/modal_book",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/modal","core/custom_interaction_events","core/modal_registry","core/str"],(function(exports,$,ajax,ModalFactory,ModalEvents,Notification,Modal,CustomEvents,ModalRegistry,Str){let SELECTORS_CLOSE_BUTTON="[data-action='cancel']",SELECTORS_CONTENT_BLOCK="[data-action='book_content_block']",SELECTORS_CLOSE_CROSS=".close",SELECTORS_MODAL_BOOK_BUTTON='[data-action="book_modal"]',ModalBook=function(root){Modal.call(this,root),ModalBook.prototype.modal=this,this.getFooter().find(SELECTORS_CLOSE_BUTTON).length||Notification.exception({message:Str.get_string("lanebs_error_close","mod_lanebs")})};return ModalBook.TYPE="mod_lanebs-book",ModalBook.CONTENT_BLOCK=SELECTORS_CONTENT_BLOCK,ModalBook.prototype=Object.create(Modal.prototype),ModalBook.prototype.constructor=ModalBook,ModalBook.prototype.MODAL_BOOK_BUTTON=SELECTORS_MODAL_BOOK_BUTTON,ModalBook.prototype.registerEventListeners=function(){Modal.prototype.registerEventListeners.call(this),this.getRoot().on(CustomEvents.events.activate,SELECTORS_CLOSE_BUTTON+", "+SELECTORS_CLOSE_CROSS,function(){this.destroy(),this.getBackdrop().then((function(backdrop){backdrop.hide()}))}.bind(this)),this.getModal().on(CustomEvents.events.scrollBottom,SELECTORS_CONTENT_BLOCK,(function(e){let mobile=!!navigator.userAgent.toLowerCase().match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\.browser|up\.link|webos|wos|ios)/g);mobile=mobile||window.innerWidth<1006;let id=$(e.currentTarget).attr("data-id");ajax.call([{methodname:"mod_lanebs_book_content",args:{id:id,mobile:mobile}}])[0].then((function(response){return response})).done((function(response){let pageNumber=$(SELECTORS_CONTENT_BLOCK).attr("data-page"),type=$(SELECTORS_CONTENT_BLOCK).attr("data-type");ModalBook.prototype.getBookResult(response.body,pageNumber,id,type),ajax.call([{methodname:"mod_lanebs_send_log",args:{id:id,type:type}}])})).fail((function(response){console.log(response)}))}))},ModalBook.prototype.getBookResult=function(response,pageNumber,bookId){let type=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"book",iframeBook=document.getElementById("book_iframe"),readerUrl="https://reader.lanbook.com/"+type+"/"+bookId+"?jwtToken="+response+"&mode=moodlePlugin#"+pageNumber;$(iframeBook).attr("src",readerUrl)},ModalRegistry.register(ModalBook.TYPE,ModalBook,"mod_lanebs/modal_book"),ModalBook}));

//# sourceMappingURL=modal_book.min.js.map