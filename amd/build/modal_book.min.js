define("mod_lanebs/modal_book",["exports","core/modal","jquery","core/ajax","core/custom_interaction_events"],(function(_exports,_modal,_jquery,_ajax,_custom_interaction_events){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal=_interopRequireDefault(_modal),_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events);class ModalBook extends _modal.default{configure(modalConfig){super.configure(modalConfig),ModalBook.CONTENT_BLOCK=ModalBook.SELECTORS.CONTENT_BLOCK}registerEventListeners(){super.registerEventListeners();const modal=this;this.getRoot().on(_custom_interaction_events.default.events.activate,ModalBook.SELECTORS.CLOSE_BUTTON,(()=>{modal.destroy()})),this.getModal().on(_custom_interaction_events.default.events.scrollBottom,ModalBook.SELECTORS.CONTENT_BLOCK,(function(e){let agent=navigator.userAgent.toLowerCase(),preg=new RegExp("android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up.browser|up.link|webos|wos|ios","g"),mobile=!!agent.match(preg);mobile=mobile||window.innerWidth<1006;let id=(0,_jquery.default)(e.currentTarget).attr("data-id");_ajax.default.call([{methodname:"mod_lanebs_book_content",args:{id:id,mobile:mobile}}])[0].then((function(response){let pageNumber=(0,_jquery.default)(ModalBook.SELECTORS.CONTENT_BLOCK).attr("data-page"),type=(0,_jquery.default)(ModalBook.SELECTORS.CONTENT_BLOCK).attr("data-type");ModalBook.getBookResult(response.body,pageNumber,id,type),_ajax.default.call([{methodname:"mod_lanebs_send_log",args:{id:id,type:type}}])})).fail((function(response){return window.console.log(response),response}))}))}}return _exports.default=ModalBook,_defineProperty(ModalBook,"TYPE","mod_lanebs/modal_book"),_defineProperty(ModalBook,"TEMPLATE","mod_lanebs/modal_book"),_defineProperty(ModalBook,"CONTENT_BLOCK",void 0),_defineProperty(ModalBook,"SELECTORS",{CLOSE_BUTTON:".modal_content_lan_reader [data-action='cancel']",CONTENT_BLOCK:"[data-action='book_content_block']",CLOSE_CROSS:"modal_content_lan_reader .close",ROOT_MODAL:"[data-region='modal-container']",CONTAINER:"[data-region='modal-container']",MODAL:"[data-region='modal']",MODAL_BOOK_BUTTON:'[data-action="book_modal"]'}),_defineProperty(ModalBook,"getBookResult",(function(response,pageNumber,bookId){let type=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"book",iframeBook=document.getElementById("book_iframe"),readerBase="https://reader.lanbook.com/"+type+"/",readerUrl=readerBase+bookId+"?jwtToken="+response+"&mode=moodlePlugin#"+pageNumber;(0,_jquery.default)(iframeBook).attr("src",readerUrl)})),_exports.default}));

//# sourceMappingURL=modal_book.min.js.map