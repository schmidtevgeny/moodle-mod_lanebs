{"version":3,"file":"modal_search.min.js","sources":["../src/modal_search.js"],"sourcesContent":["define([\n    \"exports\",\n    \"jquery\",\n    \"core/ajax\",\n    \"core/modal_factory\",\n    \"core/modal_events\",\n    \"core/notification\",\n    \"core/modal\",\n    \"core/custom_interaction_events\",\n    \"core/modal_registry\",\n    \"core/str\",\n    \"mod_lanebs/modal_book\",\n    \"mod_lanebs/modal_book_handle\",\n    \"mod_lanebs/modal_video\",\n], function (\n    exports,\n    $,\n    ajax,\n    ModalFactory,\n    ModalEvents,\n    Notification,\n    Modal,\n    CustomEvents,\n    ModalRegistry,\n    Str,\n    ModalBook,\n    ModalBookHandler,\n    ModalVideo,\n) {\n    $.fn.serializeAssoc = function() {\n        var data = {};\n        $.each( this.serializeArray(), function( key, obj ) {\n            var a = obj.name.match(/(.*?)\\[(.*?)\\]/);\n            if(a !== null)\n            {\n                var subName = a[1];\n                var subKey = a[2];\n\n                if( !data[subName] ) {\n                    data[subName] = [ ];\n                }\n\n                if (!subKey.length) {\n                    subKey = data[subName].length;\n                }\n\n                if( data[subName][subKey] ) {\n                    if( $.isArray( data[subName][subKey] ) ) {\n                        data[subName][subKey].push( obj.value );\n                    } else {\n                        data[subName][subKey] = [ ];\n                        data[subName][subKey].push( obj.value );\n                    }\n                } else {\n                    data[subName][subKey] = obj.value;\n                }\n            } else {\n                if( data[obj.name] ) {\n                    if( $.isArray( data[obj.name] ) ) {\n                        data[obj.name].push( obj.value );\n                    } else {\n                        data[obj.name] = [ ];\n                        data[obj.name].push( obj.value );\n                    }\n                } else {\n                    data[obj.name] = obj.value;\n                }\n            }\n        });\n        return data;\n    };\n\n    let SELECTORS = {\n        SEARCH_TEXTBOX: \"[data-action='search_text']\",\n        START_SEARCH: \"[data-action='search_button']\",\n        START_SEARCH_CLEAR: \"[name='clear_search']\",\n        CANCEL_BUTTON: \"[data-action='cancel']\",\n        CONTENT_BLOCK: \"[data-action='content_block']\",\n        BREADCRUMBS: \".breadcrumbs p\",\n        CONTENT_NAME: \"[name='content_name']\",\n        TRIGGER_BOOK: \".trigger_book\",\n        ADD_BOOK: \"[name='add_book']\",\n        CATEGORY_BUTTON: \"[data-action='category_tree']\",\n        CATEGORY_BLOCK: \"[data-action='categories']\",\n        BOOK_PAGINATION: \"#books_pagination li.page-item\",\n        START_PAGE_CLASS: \"page-start\",\n        END_PAGE_CLASS: \"page-end\",\n        PROGRESS: \".loader\",\n        BOOK_FILTER: \".book_filter\",\n        EDU_FILTER: \".edu_filter\",\n        SEARCH_FORM: \"#search_form\"\n    };\n\n    let OUTER_SELECTORS = {\n        PAGE_NUMBER_FIELD: \"#id_page_number\",\n        NAME_FIELD: \"#id_name\",\n        CONTENT_FIELD: \"[name='content']\",\n    };\n\n    let LIMIT_ON_PAGE = 10;\n\n    /**\n     * Constructor for the Modal\n     *\n     */\n    let ModalSearch = function(root) {\n        Modal.call(this, root);\n\n        if (!this.getBody().find(SELECTORS.SEARCH_TEXTBOX).length) {\n            Str.get_string('lanebs_error_textbox', 'mod_lanebs').then(function (string) {\n                Notification.exception({message: string});\n            });\n        }\n        if (!this.getBody().find(SELECTORS.START_SEARCH).length) {\n            Str.get_string('lanebs_error_search', 'mod_lanebs').then(function (string) {\n                Notification.exception({message: string});\n            });\n        }\n    };\n\n    ModalSearch.TYPE = 'mod_lanebs-search';\n    ModalSearch.prototype = Object.create(Modal.prototype);\n    ModalSearch.prototype.constructor = ModalSearch;\n    ModalSearch.prototype.breadcrumbs = {};\n\n    ModalSearch.prototype.registerEventListeners = function () {\n        Modal.prototype.registerEventListeners.call(this);\n        let disabledEnterSubmit = function (e) {\n            if (e.keyCode === 13) {\n                submitFunction(e);\n                return false;\n            }\n        };\n        let disabledKeyUp = function (e) {\n            if (e.keyCode !== false) {\n                e.preventDefault();\n                return false;\n            }\n        };\n        let submitFunction = function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            let id = $(SELECTORS.CATEGORY_BLOCK).attr('data-id');\n            let args = {\n                searchParam: $(e.target.form).serializeAssoc(),\n                page: 1,\n                limit: LIMIT_ON_PAGE,\n                catId: id\n            };\n            $(SELECTORS.PROGRESS).toggleClass('hide');\n            ModalSearch.prototype.getAjaxCall('mod_lanebs_search_books', args, ModalSearch.prototype.getSearchResult)\n                .then(function () {\n                    ModalSearch.prototype.resetPagination();\n                    $(SELECTORS.PROGRESS).toggleClass('hide');\n                });\n        };\n\n        let getCategoryTree = function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            let categoryId = [null];\n            let args = {\n                categoryId: categoryId\n            };\n            ModalSearch.prototype.getAjaxCall('mod_lanebs_category_tree', args, ModalSearch.prototype.printCategories);\n        };\n\n        let setPagination = function (e) {\n            if ($(e.currentTarget).hasClass('disabled')) {\n                return true;\n            }\n            let page, maxPage;\n            if ($(SELECTORS.CONTENT_BLOCK).attr('data-page') === undefined) {\n                maxPage = 0;\n            }\n            else {\n                maxPage = parseInt($(SELECTORS.CONTENT_BLOCK).attr('data-page'));\n            }\n            if ($(e.currentTarget).hasClass(SELECTORS.START_PAGE_CLASS)) {\n                if (maxPage > 0) {\n                    page = 1;\n                }\n                else {\n                    page = 0;\n                }\n            }\n            else if ($(e.currentTarget).hasClass(SELECTORS.END_PAGE_CLASS)) {\n                page = maxPage;\n            }\n            else {\n                page = parseInt($(e.currentTarget).attr('data-page'));\n            }\n            let id = $(SELECTORS.CATEGORY_BLOCK).attr('data-id');\n            let args = {\n                searchParam: $(SELECTORS.SEARCH_FORM).serializeAssoc(),\n                page: page,\n                limit: LIMIT_ON_PAGE,\n                catId: id\n            };\n            let prevPage = $(SELECTORS.BOOK_PAGINATION).find('a.prev').closest('li.page-item');\n            let nextPage = $(SELECTORS.BOOK_PAGINATION).find('a.next').closest('li.page-item');\n            let currentPage = $(SELECTORS.BOOK_PAGINATION).find('a.active').closest('li.page-item');\n            if (page >= 2) {\n                $(prevPage).attr('data-page', page - 1);\n                $(prevPage).removeClass('disabled');\n            }\n            else if (page === 1) {\n                $(prevPage).attr('data-page', page - 1);\n                $(prevPage).addClass('disabled');\n            }\n            if (maxPage === page) {\n                $(nextPage).addClass('disabled');\n            }\n            else {\n                $(nextPage).removeClass('disabled');\n            }\n            $(nextPage).attr('data-page', page+1);\n            $(currentPage).attr('data-page', page);\n            $(currentPage).find('a.active').text(page+' '+ModalSearch.prototype.strings['lanebs_from']+' '+maxPage);\n            if (page !== 0 && maxPage !== 0) {\n                $(SELECTORS.PROGRESS).toggleClass('hide');\n                ModalSearch.prototype.getAjaxCall('mod_lanebs_search_books', args, ModalSearch.prototype.getSearchResult)\n                    .then(function () {\n                        $(SELECTORS.PROGRESS).toggleClass('hide');\n                    });\n            }\n        };\n\n        $(OUTER_SELECTORS.PAGE_NUMBER_FIELD).on('change', ModalSearch.prototype.nameFieldFill);\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.START_SEARCH, submitFunction.bind(this));\n        this.getModal().on('click', SELECTORS.START_SEARCH_CLEAR, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            $(SELECTORS.SEARCH_TEXTBOX).val('');\n            $(SELECTORS.START_SEARCH).trigger('click');\n\n            return false;\n        });\n        this.getModal().on('keypress', SELECTORS.SEARCH_TEXTBOX, disabledEnterSubmit.bind(this));\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.BOOK_PAGINATION, setPagination.bind(this));\n        this.getModal().on('keydown', SELECTORS.CONTENT_NAME, disabledKeyUp.bind(this));\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CANCEL_BUTTON, function () {\n            $(this).trigger('hide');\n        }.bind(this));\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CATEGORY_BUTTON, getCategoryTree.bind(this));\n    };\n\n    ModalSearch.prototype.nameFieldFill = function () {\n        let id = $(OUTER_SELECTORS.CONTENT_FIELD).val();\n        let name = $(OUTER_SELECTORS.NAME_FIELD).val();\n        if (id === '' && name !== '') {\n            Notification.exception({message: ModalSearch.prototype.strings['lanebs_error_book']});\n            console.log(ModalSearch.prototype.strings['lanebs_error_book']);\n        } else {\n            let page = $(OUTER_SELECTORS.PAGE_NUMBER_FIELD).val();\n            let args = {\n                id: id,\n                page: page\n            };\n            ModalSearch.prototype.getAjaxCall('mod_lanebs_toc_name', args, function (response) {\n                let tocName = response;\n                if (tocName !== undefined && page !== '1') {\n                    let name = $(OUTER_SELECTORS.NAME_FIELD).val();\n                    let pg = ModalSearch.prototype.strings['lanebs_read_pg'];\n                    let regexp = new RegExp(', ' + pg + '.+', 'gi');\n                    $(OUTER_SELECTORS.NAME_FIELD).val(name.replace(regexp, '') + ', ' + pg + '.' + page + ', ' + tocName);\n                }\n            });\n        }\n    };\n\n    ModalSearch.prototype.padTo2Digits = function (num) {\n        return num.toString().padStart(2, '0');\n    }\n\n    ModalSearch.prototype.formatDate = function (date) {\n        return [\n            ModalSearch.prototype.padTo2Digits(date.getDate()),\n            ModalSearch.prototype.padTo2Digits(date.getMonth() + 1),\n            date.getFullYear(),\n        ].join('.');\n    }\n\n    ModalSearch.prototype.getSearchResult = function (response) {\n        $(SELECTORS.CONTENT_BLOCK).empty();\n        let maxPage = Math.ceil(response.body.total / LIMIT_ON_PAGE);\n        if (response.body.items.length) {\n            $.each(response.body.items, function(number, item) {\n                let descriptionBlock =\n                    '<a class=\"\" data-toggle=\"collapse\" href=\"#collapseDescription'+item.id+'\" role=\"button\">' +\n                        ModalSearch.prototype.strings['lanebs_show_desc'] +\n                    '</a>' +\n                    '<div class=\"collapse\" id=\"collapseDescription'+item.id+'\">' + item.description + '</div>';\n                if (item.description === null || item.description === '') {\n                    item.description = '';\n                    descriptionBlock = '';\n                }\n                $(SELECTORS.CONTENT_BLOCK).append(\n                    '<div class=\"item d-flex\" data-id=\"' + item.id + '\">' +\n                        '<div class=\"cover\" style=\"flex:0.2;\">' +\n                            '<img src=\"'+item.cover+'\" class=\"book_cover\" alt=\"'+ModalSearch.prototype.strings['lanebs_cover']+'\">' +\n                        '</div>' +\n                        '<div class=\"item_content\" style=\"flex:0.55;\">' +\n                            '<span class=\"book_biblio_record\">' + item.biblioRecord.replace(/00.00.0000/, ModalSearch.prototype.formatDate(new Date())) +'</span><br>' +\n                            '<span class=\"book_author hidden\">' + item.author + '</span>' +\n                            '<span class=\"book_title hidden\">' + item.title + '</span>' +\n                            descriptionBlock +\n                        '</div>' +\n                        '<div style=\"flex:0.25;\">' +\n                            '<button type=\"button\" name=\"add_book\" class=\"btn btn-sm ml-3\" style=\"color: #174c8d;' +\n                                    'background-color: white;border-color: #4285f4;\">'+ModalSearch.prototype.strings['lanebs_add']+'</button>' +\n                            '<button type=\"button\" class=\"trigger_book btn btn-sm ml-3 float-right\" style=\"color: #174c8d;' +\n                                    'background-color: white;border-color: #4285f4;\" data-page=\"'+ item.page_number +'\">'+ModalSearch.prototype.strings['lanebs_preshow']+'</button>'+\n                            '<br>' +\n                        '</div>' +\n                    '</div><hr style=\"margin-top:5px;\">');\n            });\n        }\n        else {\n            $(SELECTORS.CONTENT_BLOCK).append('<div class=\"item\">'+ModalSearch.prototype.strings['lanebs_error_empty_search']+'</div>');\n        }\n        $(SELECTORS.CONTENT_BLOCK).attr('data-page', maxPage);\n        $(SELECTORS.TRIGGER_BOOK).on('click', function (e) {\n            let id = $(e.target).closest('.item').attr('data-id');\n            let pageNumber = $(SELECTORS.BOOK_FILTER).val() === 'toc' ? $(e.target).attr('data-page') : null;\n            ModalBookHandler.init(e, id, pageNumber);\n        });\n        $(SELECTORS.ADD_BOOK).on('click', function (e) {\n            let id = $(e.target).closest('.item').attr('data-id');\n            let contentName = $('[name=\"content_name\"]');\n            let biblioRecordField = $('[name=\"biblio_record\"]');\n            let coverField = $('[name=\"cover\"]');\n            let resourceNameField = $('#id_name');\n            let bookTitle = $(e.target).closest('.item').find('.item_content .book_title').text();\n            let bookAuthor = $(e.target).closest('.item').find('.item_content .book_author').text();\n            let bookCover = $(e.target).closest('.item').find('.book_cover').attr('src');\n            let bookBiblioRecord = $(e.target).closest('.item').find('.item_content .book_biblio_record').text();\n            resourceNameField.val(bookAuthor+' - '+bookTitle);\n            contentName.removeClass('is-invalid');\n            contentName.siblings('#id_error_content_name').text('');\n            contentName.val(bookTitle);\n            $('[name=\"content\"]').val(id);\n            biblioRecordField.val(bookBiblioRecord);\n            coverField.val(bookCover);\n            $(SELECTORS.CANCEL_BUTTON).trigger('click');\n            ModalSearch.prototype.nameFieldFill();\n            // clearing and updating video modal\n            ModalVideo.prototype.resetModal();\n        });\n    };\n\n    ModalSearch.prototype.printCategories = function (response) {\n        $(SELECTORS.CATEGORY_BLOCK).empty();\n        $.each(response.body.items, function (number, item) {\n            if (item.available === false) {\n                return false;\n            }\n            $(SELECTORS.CATEGORY_BLOCK).append(\n                '<div style=\"cursor:pointer;color:#174c8d;background-color:white;\" ' +\n                     'class=\"item btn-sm\" data-id=\"'+item.id+'\" data-expand=\"'+item.hasChild+'\" ' +\n                     'data-parent=\"'+item.parent_id+'\">' +\n                    '<span>'+item.name+'</span>' +\n                '</div>');\n\n            $(SELECTORS.CATEGORY_BLOCK).find('[data-id=\"'+item.id+'\"]').click({item: item}, function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                let id = $(e.currentTarget).attr('data-id');\n                $(SELECTORS.CATEGORY_BLOCK).attr('data-id', id);\n                ModalSearch.prototype.clearCurrentCrumb(response.body.items);\n                ModalSearch.prototype.breadcrumbs[$(this).find('span').text()] = item;\n                if (item.hasChild) {\n                    let args = {\n                        categoryId: [id]\n                    };\n                    ModalSearch.prototype.getAjaxCall('mod_lanebs_category_tree', args, ModalSearch.prototype.printCategories);\n                }\n                else {\n                    if ($(this).hasClass('bg-primary')) {\n                        $(this).removeClass('bg-primary');\n                        let parentId = $(SELECTORS.CATEGORY_BLOCK).find('.item:last').attr('data-parent');\n                        $(SELECTORS.CATEGORY_BLOCK).attr('data-id', parentId);\n                        id = parentId;\n                        ModalSearch.prototype.clearCurrentCrumb(response.body.items);\n                    }\n                    else {\n                        $(this).addClass('bg-primary');\n                        $(this).siblings().removeClass('bg-primary');\n                        $(SELECTORS.CATEGORY_BLOCK).attr('data-id', id);\n                    }\n                }\n                ModalSearch.prototype.printBreadcrumbs();\n                $(SELECTORS.START_SEARCH).trigger('click');\n            });\n        });\n\n        let parent_id = $(SELECTORS.CATEGORY_BLOCK).find('.item:last').attr('data-parent');\n\n        $(SELECTORS.CATEGORY_BLOCK).prepend(\n            '<div style=\"cursor:pointer;margin-bottom:15px;color:#174c8d;background-color:white;\" ' +\n                  'class=\"btn-sm category_back\" data-id=\"'+parent_id+'\">' +\n                '<span>'+ModalSearch.prototype.strings['lanebs_BACK']+'</span>' +\n            '</div>');\n        $(SELECTORS.CATEGORY_BLOCK).find('.category_back').on('click', function () {\n            let parent_id = $(this).attr('data-id');\n            let id = ModalSearch.prototype.searchParentId(parent_id);\n            if (id === null) {\n                id = 'null';\n            }\n            $(SELECTORS.CATEGORY_BLOCK).attr('data-id', id);\n            let args = {\n                categoryId: [id]\n            };\n            if ($(SELECTORS.CATEGORY_BLOCK).find('.item.bg-primary').length > 0) {\n                ModalSearch.prototype.clearCrumbs(2);\n            }\n            else {\n                ModalSearch.prototype.clearCrumbs(1);\n            }\n            ModalSearch.prototype.printBreadcrumbs();\n            ModalSearch.prototype.getAjaxCall('mod_lanebs_category_tree', args, ModalSearch.prototype.printCategories);\n        });\n\n    };\n\n    ModalSearch.prototype.printBreadcrumbs = function () {\n        let crumbs = ModalSearch.prototype.breadcrumbs;\n        let html = '';\n        $(SELECTORS.BREADCRUMBS).empty();\n        $.each(crumbs, function (item, number) {\n            html += '<span class=\"item\" data-id=\"'+number.id+'\">'+item+'</span> -> ';\n        });\n        html = html.slice(0, -3);\n        $(SELECTORS.BREADCRUMBS).append(html);\n    };\n\n    ModalSearch.prototype.getAjaxCall = function (methodname, args, callback) {\n        return ajax.call([\n            {\n                methodname: methodname,\n                args,\n            }\n        ])[0].then(function(response) {\n            return response;\n        }).done(function(response) {\n            callback(JSON.parse(response['body']));\n            return true;\n        }).fail(function (response) {\n            console.log(response);\n            return false;\n        });\n    };\n\n    ModalSearch.prototype.resetPagination = function () {\n        let maxPage = parseInt($(SELECTORS.CONTENT_BLOCK).attr('data-page'));\n        $(SELECTORS.BOOK_PAGINATION).find('a.prev').closest('li.page-item').addClass('disabled');\n        $(SELECTORS.BOOK_PAGINATION).find('a.prev').closest('li.page-item').attr('data-page', 0);\n        $(SELECTORS.BOOK_PAGINATION).find('a.active').closest('li.page-item').attr('data-page', 1);\n        $(SELECTORS.BOOK_PAGINATION).find('a.next').closest('li.page-item').attr('data-page', 2);\n        if (maxPage > 1) {\n            $(SELECTORS.BOOK_PAGINATION).find('a.active').text(1+' '+ModalSearch.prototype.strings['lanebs_from']+' '+maxPage);\n            $(SELECTORS.BOOK_PAGINATION).find('a.next').closest('li.page-item').removeClass('disabled');\n        }\n        else {\n            $(SELECTORS.BOOK_PAGINATION).find('a.active').text(maxPage+' '+ModalSearch.prototype.strings['lanebs_from']+' '+maxPage);\n            $(SELECTORS.BOOK_PAGINATION).find('a.next').closest('li.page-item').addClass('disabled');\n        }\n    };\n\n    ModalSearch.prototype.clearCurrentCrumb = function (data) {\n        let tmp = ModalSearch.prototype.breadcrumbs;\n        let lastCrumb = tmp[Object.keys(tmp)[Object.keys(tmp).length - 1]];\n        $.each(data, function (number, item) {\n            if (undefined !== lastCrumb) {\n                if (item.id === lastCrumb.id) {\n                    delete ModalSearch.prototype.breadcrumbs[item.name];\n                }\n            }\n        });\n    };\n\n    ModalSearch.prototype.clearCrumbs = function (count) {\n        let keys = null;\n        let last = null;\n        for (let i = 0; i < count; i++) {\n            keys = Object.keys(ModalSearch.prototype.breadcrumbs);\n            last = keys[keys.length-1];\n            delete ModalSearch.prototype.breadcrumbs[last];\n        }\n    };\n\n    ModalSearch.prototype.searchParentId = function (id) {\n        let parentId = null;\n        $.each(ModalSearch.prototype.breadcrumbs, function (number, item) {\n            if (item.id == id) {\n                parentId = item.parent_id;\n            }\n        });\n        return parentId;\n    };\n\n    ModalRegistry.register(ModalSearch.TYPE, ModalSearch, 'mod_lanebs/modal_search');\n\n    return ModalSearch;\n});"],"names":["define","exports","$","ajax","ModalFactory","ModalEvents","Notification","Modal","CustomEvents","ModalRegistry","Str","ModalBook","ModalBookHandler","ModalVideo","fn","serializeAssoc","data","each","this","serializeArray","key","obj","a","name","match","subName","subKey","length","isArray","push","value","SELECTORS","OUTER_SELECTORS","ModalSearch","root","call","getBody","find","get_string","then","string","exception","message","TYPE","prototype","Object","create","constructor","breadcrumbs","registerEventListeners","submitFunction","e","preventDefault","stopPropagation","id","attr","args","searchParam","target","form","page","limit","catId","toggleClass","getAjaxCall","getSearchResult","resetPagination","on","nameFieldFill","getModal","events","activate","bind","val","trigger","keyCode","currentTarget","hasClass","maxPage","undefined","parseInt","prevPage","closest","nextPage","currentPage","removeClass","addClass","text","strings","categoryId","printCategories","console","log","response","tocName","pg","regexp","RegExp","replace","padTo2Digits","num","toString","padStart","formatDate","date","getDate","getMonth","getFullYear","join","empty","Math","ceil","body","total","items","number","item","descriptionBlock","description","append","cover","biblioRecord","Date","author","title","page_number","pageNumber","init","contentName","biblioRecordField","coverField","resourceNameField","bookTitle","bookAuthor","bookCover","bookBiblioRecord","siblings","resetModal","available","hasChild","parent_id","click","clearCurrentCrumb","parentId","printBreadcrumbs","prepend","searchParentId","clearCrumbs","crumbs","html","slice","methodname","callback","done","JSON","parse","fail","tmp","lastCrumb","keys","count","last","i","register"],"mappings":"AAAAA,iCAAO,CACH,UACA,SACA,YACA,qBACA,oBACA,oBACA,aACA,iCACA,sBACA,WACA,wBACA,+BACA,2BACD,SACCC,QACAC,EACAC,KACAC,aACAC,YACAC,aACAC,MACAC,aACAC,cACAC,IACAC,UACAC,iBACAC,YAEAX,EAAEY,GAAGC,eAAiB,WAClB,IAAIC,KAAO,GAuCX,OAtCAd,EAAEe,KAAMC,KAAKC,kBAAkB,SAAUC,IAAKC,KAC1C,IAAIC,EAAID,IAAIE,KAAKC,MAAM,kBACvB,GAAS,OAANF,EACH,CACI,IAAIG,QAAUH,EAAE,GACZI,OAASJ,EAAE,GAEVN,KAAKS,WACNT,KAAKS,SAAW,IAGfC,OAAOC,SACRD,OAASV,KAAKS,SAASE,QAGvBX,KAAKS,SAASC,SACVxB,EAAE0B,QAASZ,KAAKS,SAASC,WAGzBV,KAAKS,SAASC,QAAU,IAFxBV,KAAKS,SAASC,QAAQG,KAAMR,IAAIS,QAMpCd,KAAKS,SAASC,QAAUL,IAAIS,WAG5Bd,KAAKK,IAAIE,OACLrB,EAAE0B,QAASZ,KAAKK,IAAIE,SAGpBP,KAAKK,IAAIE,MAAQ,IAFjBP,KAAKK,IAAIE,MAAMM,KAAMR,IAAIS,QAM7Bd,KAAKK,IAAIE,MAAQF,IAAIS,SAI1Bd,MAGX,IAAIe,yBACgB,8BADhBA,uBAEc,gCAFdA,6BAGoB,wBAHpBA,wBAIe,yBAJfA,wBAKe,gCALfA,sBAMa,iBANbA,uBAOc,wBAPdA,uBAQc,gBARdA,mBASU,oBATVA,0BAUiB,gCAVjBA,yBAWgB,6BAXhBA,0BAYiB,iCAZjBA,2BAakB,aAblBA,yBAcgB,WAdhBA,mBAeU,UAfVA,sBAgBa,eAhBbA,sBAkBa,eAGbC,kCACmB,kBADnBA,2BAEY,WAFZA,8BAGe,mBASfC,YAAc,SAASC,MACvB3B,MAAM4B,KAAKjB,KAAMgB,MAEZhB,KAAKkB,UAAUC,KAAKN,0BAA0BJ,QAC/CjB,IAAI4B,WAAW,uBAAwB,cAAcC,MAAK,SAAUC,QAChElC,aAAamC,UAAU,CAACC,QAASF,YAGpCtB,KAAKkB,UAAUC,KAAKN,wBAAwBJ,QAC7CjB,IAAI4B,WAAW,sBAAuB,cAAcC,MAAK,SAAUC,QAC/DlC,aAAamC,UAAU,CAACC,QAASF,aAsY7C,OAjYAP,YAAYU,KAAO,qBACnBV,YAAYW,UAAYC,OAAOC,OAAOvC,MAAMqC,YACtBG,YAAcd,YACpCA,YAAYW,UAAUI,YAAc,GAEpCf,YAAYW,UAAUK,uBAAyB,WAC3C1C,MAAMqC,UAAUK,uBAAuBd,KAAKjB,MAC5C,IAYIgC,eAAiB,SAAUC,GAC3BA,EAAEC,iBACFD,EAAEE,kBACF,IAAIC,GAAKpD,EAAE6B,0BAA0BwB,KAAK,WACtCC,KAAO,CACPC,YAAavD,EAAEiD,EAAEO,OAAOC,MAAM5C,iBAC9B6C,KAAM,EACNC,MA/CQ,GAgDRC,MAAOR,IAEXpD,EAAE6B,oBAAoBgC,YAAY,QAClC9B,YAAYW,UAAUoB,YAAY,0BAA2BR,KAAMvB,YAAYW,UAAUqB,iBACpF1B,MAAK,WACFN,YAAYW,UAAUsB,kBACtBhE,EAAE6B,oBAAoBgC,YAAY,YA2E9C7D,EAAE8B,mCAAmCmC,GAAG,SAAUlC,YAAYW,UAAUwB,eACxElD,KAAKmD,WAAWF,GAAG3D,aAAa8D,OAAOC,SAAUxC,uBAAwBmB,eAAesB,KAAKtD,OAC7FA,KAAKmD,WAAWF,GAAG,QAASpC,8BAA8B,SAAUoB,GAMhE,OALAA,EAAEC,iBACFD,EAAEE,kBACFnD,EAAE6B,0BAA0B0C,IAAI,IAChCvE,EAAE6B,wBAAwB2C,QAAQ,UAE3B,KAEXxD,KAAKmD,WAAWF,GAAG,WAAYpC,yBA/GL,SAAUoB,GAChC,GAAkB,KAAdA,EAAEwB,QAEF,OADAzB,eAAeC,IACR,GA4G8DqB,KAAKtD,OAClFA,KAAKmD,WAAWF,GAAG3D,aAAa8D,OAAOC,SAAUxC,0BAxE7B,SAAUoB,GAC1B,GAAIjD,EAAEiD,EAAEyB,eAAeC,SAAS,YAC5B,OAAO,EAEX,IAAIjB,KAAMkB,QAENA,aADiDC,IAAjD7E,EAAE6B,yBAAyBwB,KAAK,aACtB,EAGAyB,SAAS9E,EAAE6B,yBAAyBwB,KAAK,cAI/CK,KAFJ1D,EAAEiD,EAAEyB,eAAeC,SAAS9C,4BACxB+C,QAAU,EACH,EAGA,EAGN5E,EAAEiD,EAAEyB,eAAeC,SAAS9C,0BAC1B+C,QAGAE,SAAS9E,EAAEiD,EAAEyB,eAAerB,KAAK,cAE5C,IAAID,GAAKpD,EAAE6B,0BAA0BwB,KAAK,WACtCC,KAAO,CACPC,YAAavD,EAAE6B,uBAAuBhB,iBACtC6C,KAAMA,KACNC,MAjGQ,GAkGRC,MAAOR,IAEP2B,SAAW/E,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAC/DC,SAAWjF,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAC/DE,YAAclF,EAAE6B,2BAA2BM,KAAK,YAAY6C,QAAQ,gBACpEtB,MAAQ,GACR1D,EAAE+E,UAAU1B,KAAK,YAAaK,KAAO,GACrC1D,EAAE+E,UAAUI,YAAY,aAEV,IAATzB,OACL1D,EAAE+E,UAAU1B,KAAK,YAAaK,KAAO,GACrC1D,EAAE+E,UAAUK,SAAS,aAErBR,UAAYlB,KACZ1D,EAAEiF,UAAUG,SAAS,YAGrBpF,EAAEiF,UAAUE,YAAY,YAE5BnF,EAAEiF,UAAU5B,KAAK,YAAaK,KAAK,GACnC1D,EAAEkF,aAAa7B,KAAK,YAAaK,MACjC1D,EAAEkF,aAAa/C,KAAK,YAAYkD,KAAK3B,KAAK,IAAI3B,YAAYW,UAAU4C,QAAqB,YAAE,IAAIV,SAClF,IAATlB,MAA0B,IAAZkB,UACd5E,EAAE6B,oBAAoBgC,YAAY,QAClC9B,YAAYW,UAAUoB,YAAY,0BAA2BR,KAAMvB,YAAYW,UAAUqB,iBACpF1B,MAAK,WACFrC,EAAE6B,oBAAoBgC,YAAY,aAgBwCS,KAAKtD,OAC/FA,KAAKmD,WAAWF,GAAG,UAAWpC,uBA3GV,SAAUoB,GAC1B,IAAkB,IAAdA,EAAEwB,QAEF,OADAxB,EAAEC,kBACK,GAwGqDoB,KAAKtD,OAEzEA,KAAKmD,WAAWF,GAAG3D,aAAa8D,OAAOC,SAAUxC,wBAAyB,WACtE7B,EAAEgB,MAAMwD,QAAQ,SAClBF,KAAKtD,OAEPA,KAAKmD,WAAWF,GAAG3D,aAAa8D,OAAOC,SAAUxC,0BAzF3B,SAAUoB,GAC5BA,EAAEC,iBACFD,EAAEE,kBACF,IACIG,KAAO,CACPiC,WAFa,CAAC,OAIlBxD,YAAYW,UAAUoB,YAAY,2BAA4BR,KAAMvB,YAAYW,UAAU8C,kBAkFFlB,KAAKtD,QAGrGe,YAAYW,UAAUwB,cAAgB,WAClC,IAAId,GAAKpD,EAAE8B,+BAA+ByC,MACtClD,KAAOrB,EAAE8B,4BAA4ByC,MACzC,GAAW,KAAPnB,IAAsB,KAAT/B,KACbjB,aAAamC,UAAU,CAACC,QAAST,YAAYW,UAAU4C,QAA2B,oBAClFG,QAAQC,IAAI3D,YAAYW,UAAU4C,QAA2B,uBAC1D,CACH,IAAI5B,KAAO1D,EAAE8B,mCAAmCyC,MAC5CjB,KAAO,CACPF,GAAIA,GACJM,KAAMA,MAEV3B,YAAYW,UAAUoB,YAAY,sBAAuBR,MAAM,SAAUqC,UACrE,IAAIC,QAAUD,SACd,QAAgBd,IAAZe,SAAkC,MAATlC,KAAc,CACvC,IAAIrC,KAAOrB,EAAE8B,4BAA4ByC,MACrCsB,GAAK9D,YAAYW,UAAU4C,QAAwB,eACnDQ,OAAS,IAAIC,OAAO,KAAOF,GAAK,KAAM,MAC1C7F,EAAE8B,4BAA4ByC,IAAIlD,KAAK2E,QAAQF,OAAQ,IAAM,KAAOD,GAAK,IAAMnC,KAAO,KAAOkC,eAM7G7D,YAAYW,UAAUuD,aAAe,SAAUC,KAC3C,OAAOA,IAAIC,WAAWC,SAAS,EAAG,MAGtCrE,YAAYW,UAAU2D,WAAa,SAAUC,MACzC,MAAO,CACHvE,YAAYW,UAAUuD,aAAaK,KAAKC,WACxCxE,YAAYW,UAAUuD,aAAaK,KAAKE,WAAa,GACrDF,KAAKG,eACPC,KAAK,MAGX3E,YAAYW,UAAUqB,gBAAkB,SAAU4B,UAC9C3F,EAAE6B,yBAAyB8E,QAC3B,IAAI/B,QAAUgC,KAAKC,KAAKlB,SAASmB,KAAKC,MA5LtB,IA6LZpB,SAASmB,KAAKE,MAAMvF,OACpBzB,EAAEe,KAAK4E,SAASmB,KAAKE,OAAO,SAASC,OAAQC,MACzC,IAAIC,iBACA,gEAAgED,KAAK9D,GAAG,mBACpErB,YAAYW,UAAU4C,QAA0B,iBADpD,oDAGgD4B,KAAK9D,GAAG,KAAO8D,KAAKE,YAAc,SAC7D,OAArBF,KAAKE,aAA6C,KAArBF,KAAKE,cAClCF,KAAKE,YAAc,GACnBD,iBAAmB,IAEvBnH,EAAE6B,yBAAyBwF,OACvB,qCAAuCH,KAAK9D,GAA5C,oDAEqB8D,KAAKI,MAAM,6BAA6BvF,YAAYW,UAAU4C,QAAsB,aAFzG,yFAK8C4B,KAAKK,aAAavB,QAAQ,aAAcjE,YAAYW,UAAU2D,WAAW,IAAImB,OAL3H,+CAM8CN,KAAKO,OANnD,0CAO6CP,KAAKQ,MAAQ,UAClDP,iBARR,qKAYmEpF,YAAYW,UAAU4C,QAAoB,WAZ7G,oKAc+E4B,KAAKS,YAAa,KAAK5F,YAAYW,UAAU4C,QAAwB,eAdpJ,4DAqBRtF,EAAE6B,yBAAyBwF,OAAO,qBAAqBtF,YAAYW,UAAU4C,QAAmC,0BAAE,UAEtHtF,EAAE6B,yBAAyBwB,KAAK,YAAauB,SAC7C5E,EAAE6B,wBAAwBoC,GAAG,SAAS,SAAUhB,GAC5C,IAAIG,GAAKpD,EAAEiD,EAAEO,QAAQwB,QAAQ,SAAS3B,KAAK,WACvCuE,WAAgD,QAAnC5H,EAAE6B,uBAAuB0C,MAAkBvE,EAAEiD,EAAEO,QAAQH,KAAK,aAAe,KAC5F3C,iBAAiBmH,KAAK5E,EAAGG,GAAIwE,eAEjC5H,EAAE6B,oBAAoBoC,GAAG,SAAS,SAAUhB,GACxC,IAAIG,GAAKpD,EAAEiD,EAAEO,QAAQwB,QAAQ,SAAS3B,KAAK,WACvCyE,YAAc9H,EAAE,yBAChB+H,kBAAoB/H,EAAE,0BACtBgI,WAAahI,EAAE,kBACfiI,kBAAoBjI,EAAE,YACtBkI,UAAYlI,EAAEiD,EAAEO,QAAQwB,QAAQ,SAAS7C,KAAK,6BAA6BkD,OAC3E8C,WAAanI,EAAEiD,EAAEO,QAAQwB,QAAQ,SAAS7C,KAAK,8BAA8BkD,OAC7E+C,UAAYpI,EAAEiD,EAAEO,QAAQwB,QAAQ,SAAS7C,KAAK,eAAekB,KAAK,OAClEgF,iBAAmBrI,EAAEiD,EAAEO,QAAQwB,QAAQ,SAAS7C,KAAK,qCAAqCkD,OAC9F4C,kBAAkB1D,IAAI4D,WAAW,MAAMD,WACvCJ,YAAY3C,YAAY,cACxB2C,YAAYQ,SAAS,0BAA0BjD,KAAK,IACpDyC,YAAYvD,IAAI2D,WAChBlI,EAAE,oBAAoBuE,IAAInB,IAC1B2E,kBAAkBxD,IAAI8D,kBACtBL,WAAWzD,IAAI6D,WACfpI,EAAE6B,yBAAyB2C,QAAQ,SACnCzC,YAAYW,UAAUwB,gBAEtBvD,WAAW+B,UAAU6F,iBAI7BxG,YAAYW,UAAU8C,gBAAkB,SAAUG,UAC9C3F,EAAE6B,0BAA0B8E,QAC5B3G,EAAEe,KAAK4E,SAASmB,KAAKE,OAAO,SAAUC,OAAQC,MAC1C,IAAuB,IAAnBA,KAAKsB,UACL,OAAO,EAEXxI,EAAE6B,0BAA0BwF,OACxB,kGACqCH,KAAK9D,GAAG,kBAAkB8D,KAAKuB,SADpE,kBAEqBvB,KAAKwB,UAF1B,WAGaxB,KAAK7F,KAHlB,iBAMJrB,EAAE6B,0BAA0BM,KAAK,aAAa+E,KAAK9D,GAAG,MAAMuF,MAAM,CAACzB,KAAMA,OAAO,SAAUjE,GACtFA,EAAEE,kBACFF,EAAEC,iBACF,IAAIE,GAAKpD,EAAEiD,EAAEyB,eAAerB,KAAK,WAIjC,GAHArD,EAAE6B,0BAA0BwB,KAAK,UAAWD,IAC5CrB,YAAYW,UAAUkG,kBAAkBjD,SAASmB,KAAKE,OACtDjF,YAAYW,UAAUI,YAAY9C,EAAEgB,MAAMmB,KAAK,QAAQkD,QAAU6B,KAC7DA,KAAKuB,SAAU,CACf,IAAInF,KAAO,CACPiC,WAAY,CAACnC,KAEjBrB,YAAYW,UAAUoB,YAAY,2BAA4BR,KAAMvB,YAAYW,UAAU8C,sBAG1F,GAAIxF,EAAEgB,MAAM2D,SAAS,cAAe,CAChC3E,EAAEgB,MAAMmE,YAAY,cACpB,IAAI0D,SAAW7I,EAAE6B,0BAA0BM,KAAK,cAAckB,KAAK,eACnErD,EAAE6B,0BAA0BwB,KAAK,UAAWwF,UAC5CzF,GAAKyF,SACL9G,YAAYW,UAAUkG,kBAAkBjD,SAASmB,KAAKE,YAGtDhH,EAAEgB,MAAMoE,SAAS,cACjBpF,EAAEgB,MAAMsH,WAAWnD,YAAY,cAC/BnF,EAAE6B,0BAA0BwB,KAAK,UAAWD,IAGpDrB,YAAYW,UAAUoG,mBACtB9I,EAAE6B,wBAAwB2C,QAAQ,eAI1C,IAAIkE,UAAY1I,EAAE6B,0BAA0BM,KAAK,cAAckB,KAAK,eAEpErD,EAAE6B,0BAA0BkH,QACxB,8HAC+CL,UAD/C,WAEa3G,YAAYW,UAAU4C,QAAqB,YAFxD,iBAIJtF,EAAE6B,0BAA0BM,KAAK,kBAAkB8B,GAAG,SAAS,WAC3D,IAAIyE,UAAY1I,EAAEgB,MAAMqC,KAAK,WACzBD,GAAKrB,YAAYW,UAAUsG,eAAeN,WACnC,OAAPtF,KACAA,GAAK,QAETpD,EAAE6B,0BAA0BwB,KAAK,UAAWD,IAC5C,IAAIE,KAAO,CACPiC,WAAY,CAACnC,KAEbpD,EAAE6B,0BAA0BM,KAAK,oBAAoBV,OAAS,EAC9DM,YAAYW,UAAUuG,YAAY,GAGlClH,YAAYW,UAAUuG,YAAY,GAEtClH,YAAYW,UAAUoG,mBACtB/G,YAAYW,UAAUoB,YAAY,2BAA4BR,KAAMvB,YAAYW,UAAU8C,qBAKlGzD,YAAYW,UAAUoG,iBAAmB,WACrC,IAAII,OAASnH,YAAYW,UAAUI,YAC/BqG,KAAO,GACXnJ,EAAE6B,uBAAuB8E,QACzB3G,EAAEe,KAAKmI,QAAQ,SAAUhC,KAAMD,QAC3BkC,MAAQ,+BAA+BlC,OAAO7D,GAAG,KAAK8D,KAAK,iBAE/DiC,KAAOA,KAAKC,MAAM,GAAI,GACtBpJ,EAAE6B,uBAAuBwF,OAAO8B,OAGpCpH,YAAYW,UAAUoB,YAAc,SAAUuF,WAAY/F,KAAMgG,UAC5D,OAAOrJ,KAAKgC,KAAK,CACb,CACIoH,WAAYA,WACZ/F,aAEL,GAAGjB,MAAK,SAASsD,UAChB,OAAOA,YACR4D,MAAK,SAAS5D,UAEb,OADA2D,SAASE,KAAKC,MAAM9D,SAAe,QAC5B,KACR+D,MAAK,SAAU/D,UAEd,OADAF,QAAQC,IAAIC,WACL,MAIf5D,YAAYW,UAAUsB,gBAAkB,WACpC,IAAIY,QAAUE,SAAS9E,EAAE6B,yBAAyBwB,KAAK,cACvDrD,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAAgBI,SAAS,YAC7EpF,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAAgB3B,KAAK,YAAa,GACtFrD,EAAE6B,2BAA2BM,KAAK,YAAY6C,QAAQ,gBAAgB3B,KAAK,YAAa,GACxFrD,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAAgB3B,KAAK,YAAa,GAClFuB,QAAU,GACV5E,EAAE6B,2BAA2BM,KAAK,YAAYkD,KAAK,KAAMtD,YAAYW,UAAU4C,QAAqB,YAAE,IAAIV,SAC1G5E,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAAgBG,YAAY,cAGhFnF,EAAE6B,2BAA2BM,KAAK,YAAYkD,KAAKT,QAAQ,IAAI7C,YAAYW,UAAU4C,QAAqB,YAAE,IAAIV,SAChH5E,EAAE6B,2BAA2BM,KAAK,UAAU6C,QAAQ,gBAAgBI,SAAS,cAIrFrD,YAAYW,UAAUkG,kBAAoB,SAAU9H,MAChD,IAAI6I,IAAM5H,YAAYW,UAAUI,YAC5B8G,UAAYD,IAAIhH,OAAOkH,KAAKF,KAAKhH,OAAOkH,KAAKF,KAAKlI,OAAS,IAC/DzB,EAAEe,KAAKD,MAAM,SAAUmG,OAAQC,WACvBrC,IAAc+E,WACV1C,KAAK9D,KAAOwG,UAAUxG,WACfrB,YAAYW,UAAUI,YAAYoE,KAAK7F,UAM9DU,YAAYW,UAAUuG,YAAc,SAAUa,OAC1C,IAAID,KAAO,KACPE,KAAO,KACX,IAAK,IAAIC,EAAI,EAAGA,EAAIF,MAAOE,IACvBH,KAAOlH,OAAOkH,KAAK9H,YAAYW,UAAUI,aACzCiH,KAAOF,KAAKA,KAAKpI,OAAO,UACjBM,YAAYW,UAAUI,YAAYiH,OAIjDhI,YAAYW,UAAUsG,eAAiB,SAAU5F,IAC7C,IAAIyF,SAAW,KAMf,OALA7I,EAAEe,KAAKgB,YAAYW,UAAUI,aAAa,SAAUmE,OAAQC,MACpDA,KAAK9D,IAAMA,KACXyF,SAAW3B,KAAKwB,cAGjBG,UAGXtI,cAAc0J,SAASlI,YAAYU,KAAMV,YAAa,2BAE/CA,WACX"}