define ("mod_lanebs/modal_book",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/modal","core/custom_interaction_events","core/modal_registry","core/str"],function(a,b,c,d,e,f,g,h,i,j){var k={CLOSE_BUTTON:"[data-action='close_button']",CONTENT_BLOCK:"[data-action='book_content_block']",CLOSE_CROSS:".close",ROOT_MODAL:"[data-region='modal-container']"},l=function(a){g.call(this,a);if(!this.getFooter().find(k.CLOSE_BUTTON).length){f.exception({message:j.get_string("lanebs_error_close","mod_lanebs")})}};l.TYPE="mod_lanebs-book";l.CONTENT_BLOCK=k.CONTENT_BLOCK;l.prototype=Object.create(g.prototype);l.prototype.constructor=l;l.prototype.registerEventListeners=function(){g.prototype.registerEventListeners.call(this);this.getModal().on(h.events.activate,k.CLOSE_BUTTON,function(a){a.preventDefault();a.stopPropagation();this.getRoot().trigger("click")}.bind(this));this.getModal().on(h.events.scrollBottom,k.CONTENT_BLOCK,function(a){var d=navigator.userAgent.toLowerCase(),e=!!d.match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\.browser|up\.link|webos|wos|ios)/g);e=e||1006>window.innerWidth;var f=b(a.currentTarget).attr("data-id");c.call([{methodname:"mod_lanebs_book_content",args:{id:f,mobile:e}}])[0].then(function(a){return a}).done(function(a){var c=b(k.CONTENT_BLOCK).attr("data-page");l.prototype.getBookResult(a.body,c)}).fail(function(a){console.log(a)})});this.getModal().on(h.events.activate,k.CLOSE_CROSS,function(a){a.preventDefault();a.stopPropagation();this.getRoot().trigger("click")}.bind(this));this.getRoot().on(h.events.activate,function(a){var c=b(k.ROOT_MODAL);if(1<c.length){c=c[1]}else{c=c[0]}if(a.target===c){this.getRoot().remove()}return!0}.bind(this))};l.prototype.getBookResult=function(a,c){var d=document.getElementById("book_iframe");b(d).attr("src","#");d.contentWindow.document.open();d.contentWindow.location.hash="#"+c;d.contentWindow.document.write(a);d.contentWindow.document.close();var e=setInterval(function(){if(d.contentWindow.Reader.Viewer.UIInputZoom!==void 0&&d.contentWindow.Reader.Viewer.pageScale!==void 0){d.contentWindow.Reader.Viewer.pageScale(.01*50);clearInterval(e)}},1e3)};i.register(l.TYPE,l,"mod_lanebs/modal_book");return l});
//# sourceMappingURL=modal_book.min.js.map
