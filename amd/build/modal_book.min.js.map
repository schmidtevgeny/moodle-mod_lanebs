{"version":3,"file":"modal_book.min.js","sources":["../src/modal_book.js"],"sourcesContent":["import Modal from 'core/modal';\nimport $ from 'jquery';\nimport ajax from 'core/ajax';\nimport CustomEvents from 'core/custom_interaction_events';\n\nexport default class ModalBook extends Modal {\n    static TYPE = 'mod_lanebs/modal_book';\n    static TEMPLATE = 'mod_lanebs/modal_book';\n\n    static CONTENT_BLOCK;\n\n    static SELECTORS = {\n        CLOSE_BUTTON: \".modal_content_lan_reader [data-action='cancel']\",\n        CONTENT_BLOCK: \"[data-action='book_content_block']\",\n        CLOSE_CROSS: \"modal_content_lan_reader .close\",\n        ROOT_MODAL: \"[data-region='modal-container']\",\n        CONTAINER: \"[data-region='modal-container']\",\n        MODAL: \"[data-region='modal']\",\n        MODAL_BOOK_BUTTON: '[data-action=\"book_modal\"]',\n    };\n\n    configure(modalConfig) {\n        super.configure(modalConfig);\n        ModalBook.CONTENT_BLOCK = ModalBook.SELECTORS.CONTENT_BLOCK;\n    }\n\n    registerEventListeners() {\n        // Call the registerEventListeners method on the parent class.\n        super.registerEventListeners();\n        const modal = this;\n        this.getRoot().on(CustomEvents.events.activate, ModalBook.SELECTORS.CLOSE_BUTTON, () => {\n            modal.destroy();\n        });\n\n        this.getModal().on(CustomEvents.events.scrollBottom, ModalBook.SELECTORS.CONTENT_BLOCK, function (e) {\n            let agent = navigator.userAgent.toLowerCase();\n            let preg = new RegExp(\"android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|\" +\n                       \"mini|mobi|palm|phone|pie|tablet|up\\.browser|up\\.link|webos|wos|ios\", 'g');\n            let mobile = !!agent.match(preg);\n            mobile = mobile || (window.innerWidth < 1006); // kostil for ignore redirect window.location.origin + '/m'\n            let id = $(e.currentTarget).attr('data-id');\n            ajax.call([\n                {\n                    methodname: 'mod_lanebs_book_content',\n                    args: {\n                        id: id,\n                        mobile: mobile\n                    }\n                }\n            ])[0].then(function (response) {\n                let pageNumber = $(ModalBook.SELECTORS.CONTENT_BLOCK).attr('data-page');\n                let type = $(ModalBook.SELECTORS.CONTENT_BLOCK).attr('data-type');\n                ModalBook.getBookResult(response['body'], pageNumber, id, type);\n                ajax.call([\n                    {\n                        methodname: 'mod_lanebs_send_log',\n                        args: {\n                            id: id,\n                            type: type\n                        },\n                    }\n                ]);\n            }).fail(function (response) {\n                window.console.log(response);\n                return response;\n            });\n        });\n    }\n\n     static getBookResult = (response, pageNumber, bookId, type = 'book') => {\n        let iframeBook = document.getElementById('book_iframe');\n        let readerBase = 'https://reader.lanbook.com/'+type+'/';\n        let readerUrl = readerBase+bookId+'?jwtToken='+response+'&mode=moodlePlugin'+'#'+pageNumber;\n        $(iframeBook).attr('src', readerUrl);\n    };\n}\n"],"names":["ModalBook","Modal","configure","modalConfig","CONTENT_BLOCK","SELECTORS","registerEventListeners","modal","this","getRoot","on","CustomEvents","events","activate","CLOSE_BUTTON","destroy","getModal","scrollBottom","e","agent","navigator","userAgent","toLowerCase","preg","RegExp","mobile","match","window","innerWidth","id","currentTarget","attr","call","methodname","args","then","response","pageNumber","type","getBookResult","fail","console","log","CLOSE_CROSS","ROOT_MODAL","CONTAINER","MODAL","MODAL_BOOK_BUTTON","bookId","iframeBook","document","getElementById","readerBase","readerUrl"],"mappings":"8rBAKqBA,kBAAkBC,eAgBnCC,UAAUC,mBACAD,UAAUC,aAChBH,UAAUI,cAAgBJ,UAAUK,UAAUD,cAGlDE,+BAEUA,+BACAC,MAAQC,UACTC,UAAUC,GAAGC,mCAAaC,OAAOC,SAAUb,UAAUK,UAAUS,cAAc,KAC9EP,MAAMQ,kBAGLC,WAAWN,GAAGC,mCAAaC,OAAOK,aAAcjB,UAAUK,UAAUD,eAAe,SAAUc,OAC1FC,MAAQC,UAAUC,UAAUC,cAC5BC,KAAO,IAAIC,OAAO,oIAC2D,KAC7EC,SAAWN,MAAMO,MAAMH,MAC3BE,OAASA,QAAWE,OAAOC,WAAa,SACpCC,IAAK,mBAAEX,EAAEY,eAAeC,KAAK,yBAC5BC,KAAK,CACN,CACIC,WAAY,0BACZC,KAAM,CACFL,GAAIA,GACJJ,OAAQA,WAGjB,GAAGU,MAAK,SAAUC,cACbC,YAAa,mBAAErC,UAAUK,UAAUD,eAAe2B,KAAK,aACvDO,MAAO,mBAAEtC,UAAUK,UAAUD,eAAe2B,KAAK,aACrD/B,UAAUuC,cAAcH,SAAQ,KAAUC,WAAYR,GAAIS,oBACrDN,KAAK,CACN,CACIC,WAAY,sBACZC,KAAM,CACFL,GAAIA,GACJS,KAAMA,YAInBE,MAAK,SAAUJ,iBACdT,OAAOc,QAAQC,IAAIN,UACZA,kEA3DFpC,iBACH,yCADGA,qBAEC,yCAFDA,kDAAAA,sBAME,CACfc,aAAc,mDACdV,cAAe,qCACfuC,YAAa,kCACbC,WAAY,kCACZC,UAAW,kCACXC,MAAO,wBACPC,kBAAmB,+CAbN/C,2BAgEO,SAACoC,SAAUC,WAAYW,YAAQV,4DAAO,OACtDW,WAAaC,SAASC,eAAe,eACrCC,WAAa,8BAA8Bd,KAAK,IAChDe,UAAYD,WAAWJ,OAAO,aAAaZ,SAA/BgB,sBAAiEf,+BAC/EY,YAAYlB,KAAK,MAAOsB"}