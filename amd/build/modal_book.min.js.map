{"version":3,"sources":["../src/modal_book.js"],"names":["define","exports","$","ajax","ModalFactory","ModalEvents","Notification","Modal","CustomEvents","ModalRegistry","Str","SELECTORS","CLOSE_BUTTON","CONTENT_BLOCK","CLOSE_CROSS","ROOT_MODAL","ModalBook","root","call","getFooter","find","length","exception","message","get_string","TYPE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","preventDefault","stopPropagation","getRoot","trigger","bind","scrollBottom","agent","navigator","userAgent","toLowerCase","mobile","match","window","innerWidth","id","currentTarget","attr","methodname","args","then","response","done","pageNumber","getBookResult","fail","console","log","target","remove","iframeBook","document","getElementById","contentWindow","open","location","hash","write","close","timer","setInterval","Reader","Viewer","UIInputZoom","pageScale","clearInterval","register"],"mappings":"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","sourcesContent":["define([\n    \"exports\",\n    \"jquery\",\n    \"core/ajax\",\n    \"core/modal_factory\",\n    \"core/modal_events\",\n    \"core/notification\",\n    \"core/modal\",\n    \"core/custom_interaction_events\",\n    \"core/modal_registry\",\n    \"core/str\",\n], function (\n    exports,\n    $,\n    ajax,\n    ModalFactory,\n    ModalEvents,\n    Notification,\n    Modal,\n    CustomEvents,\n    ModalRegistry,\n    Str,\n) {\n    let SELECTORS = {\n        CLOSE_BUTTON: \"[data-action='close_button']\",\n        CONTENT_BLOCK: \"[data-action='book_content_block']\",\n        CLOSE_CROSS: \".close\",\n        ROOT_MODAL: \"[data-region='modal-container']\",\n    };\n\n    /**\n     * Constructor for the Modal\n     *\n     */\n    let ModalBook = function(root) {\n        Modal.call(this, root);\n\n        if (!this.getFooter().find(SELECTORS.CLOSE_BUTTON).length) {\n            Notification.exception({message: Str.get_string('lanebs_error_close', 'mod_lanebs')});\n        }\n    };\n\n    ModalBook.TYPE = 'mod_lanebs-book';\n    ModalBook.CONTENT_BLOCK = SELECTORS.CONTENT_BLOCK;\n    ModalBook.prototype = Object.create(Modal.prototype);\n    ModalBook.prototype.constructor = ModalBook;\n\n    ModalBook.prototype.registerEventListeners = function () {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n        }.bind(this));\n\n        this.getModal().on(CustomEvents.events.scrollBottom, SELECTORS.CONTENT_BLOCK, function (e) {\n            let agent = navigator.userAgent.toLowerCase();\n            let mobile = !!agent.match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\\.browser|up\\.link|webos|wos|ios)/g);\n            mobile = mobile || (window.innerWidth < 1006); // kostil for ignore redirect window.location.origin + '/m'\n            let id = $(e.currentTarget).attr('data-id');\n            ajax.call([\n            {\n                methodname: 'mod_lanebs_book_content',\n                args: {\n                    id: id,\n                    mobile: mobile\n                }\n            }\n            ])[0].then(function (response) {\n                return response;\n            }).\n            done(function (response) {\n                let pageNumber = $(SELECTORS.CONTENT_BLOCK).attr('data-page');\n                ModalBook.prototype.getBookResult(response['body'], pageNumber);\n            }).fail(function (response) {\n                console.log(response);\n            });\n        });\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_CROSS, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n        }.bind(this));\n\n        this.getRoot().on(CustomEvents.events.activate, function (e) {\n            let root = $(SELECTORS.ROOT_MODAL);\n            if (root.length > 1) { // because this modal second sometimes.\n                root = root[1];    // Kostil, but nothing to do\n            }\n            else {\n                root = root[0];\n            }\n            if (e.target === root) {\n                this.getRoot().remove();\n            }\n            return true;\n        }.bind(this));\n    };\n\n    ModalBook.prototype.getBookResult = function (response, pageNumber) {\n        let iframeBook = document.getElementById('book_iframe');\n        $(iframeBook).attr('src', '#');\n        iframeBook.contentWindow.document.open();\n        iframeBook.contentWindow.location.hash = '#' + pageNumber;\n        iframeBook.contentWindow.document.write(response);\n        iframeBook.contentWindow.document.close();\n        // for change reader scale after loading\n        // some kostil...\n        let timer = setInterval(function() {\n            if (iframeBook.contentWindow.Reader.Viewer.UIInputZoom !== undefined && iframeBook.contentWindow.Reader.Viewer.pageScale !== undefined) {\n                iframeBook.contentWindow.Reader.Viewer.pageScale(50 * 0.01);\n                clearInterval(timer);\n            }\n        }, 1000);\n    };\n\n    ModalRegistry.register(ModalBook.TYPE, ModalBook, 'mod_lanebs/modal_book');\n\n    return ModalBook;\n\n});"],"file":"modal_book.min.js"}