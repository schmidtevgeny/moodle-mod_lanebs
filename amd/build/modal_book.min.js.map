{"version":3,"file":"modal_book.min.js","sources":["../src/modal_book.js"],"sourcesContent":["define([\n    \"exports\",\n    \"jquery\",\n    \"core/ajax\",\n    \"core/modal_factory\",\n    \"core/modal_events\",\n    \"core/notification\",\n    \"core/modal\",\n    \"core/custom_interaction_events\",\n    \"core/modal_registry\",\n    \"core/str\",\n], function (\n    exports,\n    $,\n    ajax,\n    ModalFactory,\n    ModalEvents,\n    Notification,\n    Modal,\n    CustomEvents,\n    ModalRegistry,\n    Str,\n) {\n    let SELECTORS = {\n        CLOSE_BUTTON: \"[data-action='cancel']\",\n        CONTENT_BLOCK: \"[data-action='book_content_block']\",\n        CLOSE_CROSS: \".close\",\n        ROOT_MODAL: \"[data-region='modal-container']\",\n        CONTAINER: \"[data-region='modal-container']\",\n        MODAL: \"[data-region='modal']\",\n        MODAL_BOOK_BUTTON: '[data-action=\"book_modal\"]'\n    };\n\n    /**\n     * Constructor for the Modal\n     *\n     */\n    let ModalBook = function(root) {\n        Modal.call(this, root);\n        ModalBook.prototype.modal = this;\n\n        if (!this.getFooter().find(SELECTORS.CLOSE_BUTTON).length) {\n            Notification.exception({message: Str.get_string('lanebs_error_close', 'mod_lanebs')});\n        }\n    };\n\n    ModalBook.TYPE = 'mod_lanebs-book';\n    ModalBook.CONTENT_BLOCK = SELECTORS.CONTENT_BLOCK;\n\n    ModalBook.prototype = Object.create(Modal.prototype);\n    ModalBook.prototype.constructor = ModalBook;\n    ModalBook.prototype.MODAL_BOOK_BUTTON = SELECTORS.MODAL_BOOK_BUTTON;\n\n    ModalBook.prototype.registerEventListeners = function () {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getRoot().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON+', '+SELECTORS.CLOSE_CROSS, function () {\n            this.destroy();\n            this.getBackdrop().then(function (backdrop) {\n                backdrop.hide();\n            });\n        }.bind(this));\n\n        this.getModal().on(CustomEvents.events.scrollBottom, SELECTORS.CONTENT_BLOCK, function (e) {\n            let agent = navigator.userAgent.toLowerCase();\n            let mobile = !!agent.match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\\.browser|up\\.link|webos|wos|ios)/g);\n            mobile = mobile || (window.innerWidth < 1006); // kostil for ignore redirect window.location.origin + '/m'\n            let id = $(e.currentTarget).attr('data-id');\n            ajax.call([\n            {\n                methodname: 'mod_lanebs_book_content',\n                args: {\n                    id: id,\n                    mobile: mobile\n                }\n            }\n            ])[0].then(function (response) {\n                return response;\n            }).\n            done(function (response) {\n                let pageNumber = $(SELECTORS.CONTENT_BLOCK).attr('data-page');\n                let type = $(SELECTORS.CONTENT_BLOCK).attr('data-type');\n                ModalBook.prototype.getBookResult(response['body'], pageNumber, id, type);\n                ajax.call([\n                {\n                    methodname: 'mod_lanebs_send_log',\n                    args: {\n                        id: id,\n                        type: type\n                    },\n                }\n                ]);\n            }).fail(function (response) {\n                console.log(response);\n            });\n        });\n    };\n\n    ModalBook.prototype.getBookResult = function (response, pageNumber, bookId, type = 'book') {\n        let iframeBook = document.getElementById('book_iframe');\n        let readerBase = 'https://reader.lanbook.com/'+type+'/';\n        let readerUrl = readerBase+bookId+'?jwtToken='+response+'&mode=moodlePlugin'+'#'+pageNumber;\n        $(iframeBook).attr('src', readerUrl);\n    };\n\n    ModalRegistry.register(ModalBook.TYPE, ModalBook, 'mod_lanebs/modal_book');\n\n    return ModalBook;\n\n});\n"],"names":["define","exports","$","ajax","ModalFactory","ModalEvents","Notification","Modal","CustomEvents","ModalRegistry","Str","SELECTORS","ModalBook","root","call","this","prototype","modal","getFooter","find","length","exception","message","get_string","TYPE","CONTENT_BLOCK","Object","create","constructor","MODAL_BOOK_BUTTON","registerEventListeners","getRoot","on","events","activate","destroy","getBackdrop","then","backdrop","hide","bind","getModal","scrollBottom","e","mobile","navigator","userAgent","toLowerCase","match","window","innerWidth","id","currentTarget","attr","methodname","args","response","done","pageNumber","type","getBookResult","fail","console","log","bookId","arguments","undefined","iframeBook","document","getElementById","readerUrl","readerBase","register"],"mappings":"AAAAA,+BAAO,CACH,UACA,SACA,YACA,qBACA,oBACA,oBACA,aACA,iCACA,sBACA,aACD,SACCC,QACAC,EACAC,KACAC,aACAC,YACAC,aACAC,MACAC,aACAC,cACAC,KAEA,IAAIC,uBACc,yBADdA,wBAEe,qCAFfA,sBAGa,SAHbA,4BAOmB,6BAOnBC,UAAY,SAASC,MACrBN,MAAMO,KAAKC,KAAMF,MACjBD,UAAUI,UAAUC,MAAQF,KAEvBA,KAAKG,YAAYC,KAAKR,wBAAwBS,QAC/Cd,aAAae,UAAU,CAACC,QAASZ,IAAIa,WAAW,qBAAsB,iBAiE9E,OA7DAX,UAAUY,KAAO,kBACjBZ,UAAUa,cAAgBd,wBAE1BC,UAAUI,UAAYU,OAAOC,OAAOpB,MAAMS,WAC1CJ,UAAUI,UAAUY,YAAchB,UAClCA,UAAUI,UAAUa,kBAAoBlB,4BAExCC,UAAUI,UAAUc,uBAAyB,WACzCvB,MAAMS,UAAUc,uBAAuBhB,KAAKC,MAE5CA,KAAKgB,UAAUC,GAAGxB,aAAayB,OAAOC,SAAUvB,uBAAuB,KAAKA,sBAAuB,WAC/FI,KAAKoB,UACLpB,KAAKqB,cAAcC,MAAK,SAAUC,UAC9BA,SAASC,WAEfC,KAAKzB,OAEPA,KAAK0B,WAAWT,GAAGxB,aAAayB,OAAOS,aAAc/B,yBAAyB,SAAUgC,GACpF,IACIC,SADQC,UAAUC,UAAUC,cACXC,MAAM,0IAC3BJ,OAASA,QAAWK,OAAOC,WAAa,KACxC,IAAIC,GAAKjD,EAAEyC,EAAES,eAAeC,KAAK,WACjClD,KAAKW,KAAK,CACV,CACIwC,WAAY,0BACZC,KAAM,CACFJ,GAAIA,GACJP,OAAQA,WAGb,GAAGP,MAAK,SAAUmB,UACjB,OAAOA,YAEXC,MAAK,SAAUD,UACX,IAAIE,WAAaxD,EAAES,yBAAyB0C,KAAK,aAC7CM,KAAOzD,EAAES,yBAAyB0C,KAAK,aAC3CzC,UAAUI,UAAU4C,cAAcJ,SAAe,KAAGE,WAAYP,GAAIQ,MACpExD,KAAKW,KAAK,CACV,CACIwC,WAAY,sBACZC,KAAM,CACFJ,GAAIA,GACJQ,KAAMA,YAIfE,MAAK,SAAUL,UACdM,QAAQC,IAAIP,iBAKxB5C,UAAUI,UAAU4C,cAAgB,SAAUJ,SAAUE,WAAYM,QAAuB,IAAfL,KAAIM,UAAA7C,eAAA8C,IAAAD,aAAAA,aAAG,OAC3EE,WAAaC,SAASC,eAAe,eAErCC,UADa,8BAA8BX,KAAK,IACzBK,OAAO,aAAaR,SAA/Be,sBAAiEb,WACjFxD,EAAEiE,YAAYd,KAAK,MAAOiB,YAG9B7D,cAAc+D,SAAS5D,UAAUY,KAAMZ,UAAW,yBAE3CA,SAEX"}