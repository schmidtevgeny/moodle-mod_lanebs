{"version":3,"sources":["../src/modal_book.js"],"names":["define","exports","$","ajax","ModalFactory","ModalEvents","Notification","Modal","CustomEvents","ModalRegistry","Str","SELECTORS","CLOSE_BUTTON","CONTENT_BLOCK","CLOSE_CROSS","ROOT_MODAL","CONTAINER","MODAL","ModalBook","root","call","prototype","modal","getFooter","find","length","exception","message","get_string","TYPE","Object","create","constructor","registerEventListeners","getRoot","on","events","activate","destroy","getBackdrop","then","backdrop","hide","console","log","bind","getModal","scrollBottom","e","agent","navigator","userAgent","toLowerCase","mobile","match","window","innerWidth","id","currentTarget","attr","methodname","args","response","done","pageNumber","type","getBookResult","fail","bookId","iframeBook","document","getElementById","register"],"mappings":"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","sourcesContent":["define([\n    \"exports\",\n    \"jquery\",\n    \"core/ajax\",\n    \"core/modal_factory\",\n    \"core/modal_events\",\n    \"core/notification\",\n    \"core/modal\",\n    \"core/custom_interaction_events\",\n    \"core/modal_registry\",\n    \"core/str\",\n], function (\n    exports,\n    $,\n    ajax,\n    ModalFactory,\n    ModalEvents,\n    Notification,\n    Modal,\n    CustomEvents,\n    ModalRegistry,\n    Str,\n) {\n    let SELECTORS = {\n        CLOSE_BUTTON: \"[data-action='cancel']\",\n        CONTENT_BLOCK: \"[data-action='book_content_block']\",\n        CLOSE_CROSS: \".close\",\n        ROOT_MODAL: \"[data-region='modal-container']\",\n        CONTAINER: \"[data-region='modal-container']\",\n        MODAL: \"[data-region='modal']\",\n    };\n\n    /**\n     * Constructor for the Modal\n     *\n     */\n    let ModalBook = function(root) {\n        Modal.call(this, root);\n        ModalBook.prototype.modal = this;\n\n        if (!this.getFooter().find(SELECTORS.CLOSE_BUTTON).length) {\n            Notification.exception({message: Str.get_string('lanebs_error_close', 'mod_lanebs')});\n        }\n    };\n\n    ModalBook.TYPE = 'mod_lanebs-book';\n    ModalBook.CONTENT_BLOCK = SELECTORS.CONTENT_BLOCK;\n    ModalBook.prototype = Object.create(Modal.prototype);\n    ModalBook.prototype.constructor = ModalBook;\n\n    ModalBook.prototype.registerEventListeners = function () {\n        Modal.prototype.registerEventListeners.call(this);\n\n        /*this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n            this.getRoot().remove();\n            this.getModal().remove();\n        }.bind(this));\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_CROSS, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n            this.getRoot().remove()\n            this.getModal().remove();\n        }.bind(this));*/\n\n        this.getRoot().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON+', '+SELECTORS.CLOSE_CROSS, function () {\n            this.destroy();\n            this.getBackdrop().then(function (backdrop) {\n                backdrop.hide();\n            });\n            console.log('destroy');\n        }.bind(this));\n\n/*        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON+', '+SELECTORS.CLOSE_CROSS, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n            if (this.getModal() && this.getRoot()) {\n                this.getModal().remove();\n                this.getRoot().remove();\n            }\n            return true;\n        }.bind(this));\n\n        this.getRoot().click(function(e) {\n            if (!$(e.target).closest(SELECTORS.MODAL).length) {\n                if ($(e.target).closest(SELECTORS.CONTAINER).length) {\n                    this.getModal().remove();\n                    this.getRoot().remove();\n                }\n            }\n            return true;\n        }.bind(this));*/\n\n        this.getModal().on(CustomEvents.events.scrollBottom, SELECTORS.CONTENT_BLOCK, function (e) {\n            let agent = navigator.userAgent.toLowerCase();\n            let mobile = !!agent.match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\\.browser|up\\.link|webos|wos|ios)/g);\n            mobile = mobile || (window.innerWidth < 1006); // kostil for ignore redirect window.location.origin + '/m'\n            let id = $(e.currentTarget).attr('data-id');\n            ajax.call([\n            {\n                methodname: 'mod_lanebs_book_content',\n                args: {\n                    id: id,\n                    mobile: mobile\n                }\n            }\n            ])[0].then(function (response) {\n                return response;\n            }).\n            done(function (response) {\n                let pageNumber = $(SELECTORS.CONTENT_BLOCK).attr('data-page');\n                let type = $(SELECTORS.CONTENT_BLOCK).attr('data-type');\n                ModalBook.prototype.getBookResult(response['body'], pageNumber, id, type);\n            }).fail(function (response) {\n                console.log(response);\n            });\n        });\n    };\n\n    ModalBook.prototype.getBookResult = function (response, pageNumber, bookId, type = 'book') {\n        let iframeBook = document.getElementById('book_iframe');\n        let readerBase = 'https://reader.lanbook.com/'+type+'/';//'https://reader.landev.ru/book/';\n        let readerUrl = readerBase+bookId+'?jwtToken='+response+'&mode=moodlePlugin'+'#'+pageNumber;\n        $(iframeBook).attr('src', readerUrl);\n    };\n\n    ModalRegistry.register(ModalBook.TYPE, ModalBook, 'mod_lanebs/modal_book');\n\n    return ModalBook;\n\n});"],"file":"modal_book.min.js"}