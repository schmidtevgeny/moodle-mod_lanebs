{"version":3,"file":"modal_player.min.js","sources":["../src/modal_player.js"],"sourcesContent":["define([\n    \"exports\",\n    \"jquery\",\n    \"core/ajax\",\n    \"core/modal_factory\",\n    \"core/modal_events\",\n    \"core/notification\",\n    \"core/modal\",\n    \"core/custom_interaction_events\",\n    \"core/modal_registry\",\n    \"core/str\",\n], function (\n    exports,\n    $,\n    ajax,\n    ModalFactory,\n    ModalEvents,\n    Notification,\n    Modal,\n    CustomEvents,\n    ModalRegistry,\n    Str,\n) {\n    let SELECTORS = {\n        CONTENT_BLOCK: '[data-action=\"player_content_block\"]',\n        CLOSE_BUTTON: '[data-action=\"close_button\"]',\n        CLOSE_CROSS: \".close\",\n        ROOT_MODAL: \"[data-region='modal-container']\",\n        PLAYER_MODAL: 'p[data-action=\"player_modal\"]',\n    };\n\n    /**\n     * Constructor for the Modal\n     *\n     */\n    let ModalPlayer = function(root) {\n        Modal.call(this, root);\n        ModalPlayer.prototype.modal = this;\n\n        if (!this.getFooter().find(SELECTORS.CLOSE_BUTTON).length) {\n            Notification.exception({message: Str.get_string('lanebs_error_close', 'mod_lanebs')});\n        }\n    };\n\n    ModalPlayer.TYPE = 'mod_lanebs-player';\n    ModalPlayer.CONTENT_BLOCK = SELECTORS.CONTENT_BLOCK;\n    ModalPlayer.prototype = Object.create(Modal.prototype);\n    ModalPlayer.prototype.constructor = ModalPlayer;\n    ModalPlayer.prototype.PLAYER_MODAL = SELECTORS.PLAYER_MODAL;\n\n    ModalPlayer.prototype.registerEventListeners = function () {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n            this.getRoot().remove()\n            this.getModal().remove();\n        }.bind(this));\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_CROSS, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n            this.getRoot().remove()\n            this.getModal().remove();\n        }.bind(this));\n\n        this.getModal().on(CustomEvents.events.scrollBottom, SELECTORS.CONTENT_BLOCK, function (e) {\n            let agent = navigator.userAgent.toLowerCase();\n            let mobile = !!agent.match(/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\\.browser|up\\.link|webos|wos|ios)/g);\n            mobile = mobile || (window.innerWidth < 1006); // kostil for ignore redirect window.location.origin + '/m'\n            let linkId = $(e.currentTarget).attr('data-id');\n            let iframeBlock =\n                '<iframe id=\"player_iframe\" src=\"https://www.youtube.com/embed/'+linkId+'\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen style=\"width:100%;height:100%;\">' +\n                '</iframe>';\n            $(SELECTORS.CONTENT_BLOCK).append(iframeBlock);\n            ModalPlayer.prototype.modal.getBody().find(SELECTORS.CONTENT_BLOCK).append(iframeBlock);\n            ajax.call([\n                {\n                    methodname: 'mod_lanebs_send_log',\n                    args: {\n                        id: linkId,\n                        type: 'video'\n                    },\n                }\n            ]);\n        });\n    };\n\n    ModalRegistry.register(ModalPlayer.TYPE, ModalPlayer, 'mod_lanebs/modal_player');\n\n    return ModalPlayer;\n\n});"],"names":["define","exports","$","ajax","ModalFactory","ModalEvents","Notification","Modal","CustomEvents","ModalRegistry","Str","SELECTORS","ModalPlayer","root","call","this","prototype","modal","getFooter","find","length","exception","message","get_string","TYPE","CONTENT_BLOCK","Object","create","constructor","PLAYER_MODAL","registerEventListeners","getModal","on","events","activate","e","preventDefault","stopPropagation","getRoot","trigger","remove","bind","scrollBottom","mobile","navigator","userAgent","toLowerCase","match","window","innerWidth","linkId","currentTarget","attr","iframeBlock","append","getBody","methodname","args","id","type","register"],"mappings":"AAAAA,iCAAO,CACH,UACA,SACA,YACA,qBACA,oBACA,oBACA,aACA,iCACA,sBACA,aACD,SACCC,QACAC,EACAC,KACAC,aACAC,YACAC,aACAC,MACAC,aACAC,cACAC,KAEA,IAAIC,wBACe,uCADfA,uBAEc,+BAFdA,sBAGa,SAHbA,uBAKc,gCAOdC,YAAc,SAASC,MACvBN,MAAMO,KAAKC,KAAMF,MACjBD,YAAYI,UAAUC,MAAQF,KAEzBA,KAAKG,YAAYC,KAAKR,wBAAwBS,QAC/Cd,aAAae,UAAU,CAACC,QAASZ,IAAIa,WAAW,qBAAsB,iBAqD9E,OAjDAX,YAAYY,KAAO,oBACnBZ,YAAYa,cAAgBd,wBAC5BC,YAAYI,UAAYU,OAAOC,OAAOpB,MAAMS,WAC5CJ,YAAYI,UAAUY,YAAchB,YACpCA,YAAYI,UAAUa,aAAelB,uBAErCC,YAAYI,UAAUc,uBAAyB,WAC3CvB,MAAMS,UAAUc,uBAAuBhB,KAAKC,MAE5CA,KAAKgB,WAAWC,GAAGxB,aAAayB,OAAOC,SAAUvB,uBAAwB,SAAUwB,GAC/EA,EAAEC,iBACFD,EAAEE,kBACFtB,KAAKuB,UAAUC,QAAQ,SACvBxB,KAAKuB,UAAUE,SACfzB,KAAKgB,WAAWS,UAClBC,KAAK1B,OAEPA,KAAKgB,WAAWC,GAAGxB,aAAayB,OAAOC,SAAUvB,sBAAuB,SAAUwB,GAC9EA,EAAEC,iBACFD,EAAEE,kBACFtB,KAAKuB,UAAUC,QAAQ,SACvBxB,KAAKuB,UAAUE,SACfzB,KAAKgB,WAAWS,UAClBC,KAAK1B,OAEPA,KAAKgB,WAAWC,GAAGxB,aAAayB,OAAOS,aAAc/B,yBAAyB,SAAUwB,GACpF,IACIQ,SADQC,UAAUC,UAAUC,cACXC,MAAM,0IAC3BJ,OAASA,QAAWK,OAAOC,WAAa,KACxC,IAAIC,OAAShD,EAAEiC,EAAEgB,eAAeC,KAAK,WACjCC,YACA,iEAAiEH,OAAjE,4MAEJhD,EAAES,yBAAyB2C,OAAOD,aAClCzC,YAAYI,UAAUC,MAAMsC,UAAUpC,KAAKR,yBAAyB2C,OAAOD,aAC3ElD,KAAKW,KAAK,CACN,CACI0C,WAAY,sBACZC,KAAM,CACFC,GAAIR,OACJS,KAAM,gBAO1BlD,cAAcmD,SAAShD,YAAYY,KAAMZ,YAAa,2BAE/CA,WAEX"}