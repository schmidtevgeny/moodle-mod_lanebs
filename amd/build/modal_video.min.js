define ("mod_lanebs/modal_video",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/modal","core/custom_interaction_events","core/modal_registry","mod_lanebs/modal_player_handle","core/str"],function(a,b,c,d,e,f,g,h,i,j,k){var l={SUBMIT_BUTTON:"[data-action='submit_button']",OPEN_BUTTON:"#id_modal_video_button",OPEN_BUTTON_CONTAINER:"#id_modal_video_button",CANCEL_BUTTON:"[data-action='cancel_button']",CONTENT_BLOCK:"[data-action='video_content_block']",CLOSE_CROSS:".close",ROOT_MODAL:"[data-region='modal-container']",DATA_TOC:"#data-toc",BOOK_ID_SELECTOR:"[name='content']",SEARCH_CLASS:".modal_video",VIDEOS_FIELD:"input[name='videos']",DELETE_SELECTED:"span.closes",PREVIEW_CLASS:".video-item",PREVIEW_TEXT:"span.video_preview",PREVIEW_CONTAINER:".video_preview_container",TRIGGER_PLAYER:"img.modal_video",PLAY_BUTTON_HOVER:".video_play_hover"},m=function(a){g.call(this,a);m.prototype.modal=this;if(!this.getFooter().find(l.CANCEL_BUTTON).length){f.exception({message:k.get_string("lanebs_error_close","mod_lanebs")})}this.printTocs()};m.TYPE="mod_lanebs-video";m.CONTENT_BLOCK=l.CONTENT_BLOCK;m.prototype=Object.create(g.prototype);m.prototype.constructor=m;m.prototype.registerEventListeners=function(){g.prototype.registerEventListeners.call(this);this.getModal().on(h.events.activate,l.SUBMIT_BUTTON,m.prototype.updateVideoField);this.getModal().on(h.events.activate,l.CANCEL_BUTTON,function(){b(this).trigger("hide")}.bind(this))};m.prototype.printTocs=function(){var a={id:b(l.BOOK_ID_SELECTOR).val(),page:0};m.prototype.getAjaxCall("mod_lanebs_toc_name",a,function(a){var c={id:b(l.BOOK_ID_SELECTOR).val()};m.prototype.getAjaxCall("mod_lanebs_toc_videos",c,function(c){var d=m.prototype.modal.getBody(),e="",f=[],g={};if(a){a.forEach(function(a,d){var h="<ul class=\"modal_video\">",i=a.page;f[d]=!1;var j;try{c.forEach(function(a){if(a.start_page===i){f[d]=!0;j=a.unique_id+"_"+d;h+="<li class=\"modal_video\"><label for=\"video_"+j+"\" class=\"modal_video\"><p class=\"modal_video\"><input type=\"checkbox\" data-unique=\""+j+"\" class=\"modal_video\" id=\"video_"+j+"\" data-url=\""+a.link_url+"\" />"+a.link_name+"</p><img src=\""+m.prototype.getYoutubePreview(a.link_url)+"\" alt=\""+a.link_name+"\" class=\"modal_video\" data-id=\""+m.prototype.getYoutubeId(a.link_url)+"\" /><div class=\"video_play_hover\"></div></label></li>"}else if("-1"===a.start_page){f[d]=void 0;b(l.OPEN_BUTTON_CONTAINER).closest(".form-group").addClass("hidden");throw g}})}catch(a){if(a!==g)throw a}h+="</ul>";if(!0===f[d]){e+="<div class=\"item-toc\" style=\"margin-bottom:10px;\" data-page=\""+i+"\"><span>"+a.title+", "+m.prototype.strings.lanebs_read_pg+". "+a.page+"</span><br><a class=\"\" data-toggle=\"collapse\" href=\"#collapseDescription_"+i+"_"+d+"\" role=\"button\">\u0412\u0438\u0434\u0435\u043E-\u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0430\u0446\u0438\u0438</a><div class=\"collapse\" id=\"collapseDescription_"+i+"_"+d+"\">"+h+"</div></div>"}})}if(f[0]!==void 0){b(l.OPEN_BUTTON_CONTAINER).closest(".form-group").removeClass("hidden");d.find(l.DATA_TOC).html(e);b(d.find(l.TRIGGER_PLAYER)).on("click",function(a){var c=b(a.target).attr("data-id");j.init(a,c)});b(d.find(l.PLAY_BUTTON_HOVER)).on("click",function(a){a.preventDefault();a.stopPropagation();b(a.currentTarget).siblings(l.TRIGGER_PLAYER).trigger("click")})}var h=m.prototype.getIssetVideos();if(h){m.prototype.printVideos(h);m.prototype.preCheckVideos(h)}})})};m.prototype.getAjaxCall=function(a,b,d){return c.call([{methodname:a,args:b}])[0].then(function(a){return a}).done(function(a){d(JSON.parse(a.body));return!0}).fail(function(a){console.log(a);return!1})};m.prototype.printVideos=function(a){var c="<div class=\"col-md-3\"></div><div class=\"container col-md-9\">";a.forEach(function(a){c+="<div class=\"item video-item row\"><div class=\"img-wraps\"><span class=\"closes\" title=\"Delete\" data-unique=\""+a.unique+"\">\xD7</span><img width=\"100px;\" height=\"100px;\" src=\""+m.prototype.getYoutubePreview(a.link)+"\" alt=\""+a.name+"\"  class=\"img-responsive\" src=\"images/image.jpg\" data-id=\""+m.prototype.getYoutubeId(a.link)+"\"/></div><span class=\"video_preview\">"+a.name+"</span></div>"});c+="</div>";b(l.PREVIEW_CONTAINER).html(c);m.prototype.deleteSelectedEvent()};m.prototype.getYoutubeId=function(a){var b=a.split("?")[1];return new URLSearchParams(b).get("v")};m.prototype.getYoutubePreview=function(a){var b=m.prototype.getYoutubeId(a);return"https://img.youtube.com/vi/"+b+"/0.jpg"};m.prototype.getIssetVideos=function(){var a=b(l.VIDEOS_FIELD).val();try{return JSON.parse(a)}catch(a){console.log(a.message);return""}};m.prototype.preCheckVideos=function(a){a.forEach(function(a){m.prototype.modal.getBody().find("input[data-unique=\""+a.unique+"\"]").trigger("click")})};m.prototype.deleteSelectedEvent=function(){b(l.DELETE_SELECTED).each(function(a,c){b(c).on("click",function(a){var c=b(a.target).closest(l.PREVIEW_CLASS),d=b(a.target).attr("data-unique");m.prototype.modal.getBody().find("input[data-unique=\""+d+"\"]").trigger("click");b(c).remove();m.prototype.updateVideoField()})})};m.prototype.updateVideoField=function(){var a=[],c=m.prototype.modal.getBody().find("ul"+l.SEARCH_CLASS+" input:checked");c.each(function(c,d){var e=b(d).attr("data-url");a.push({link:e,name:b(d).closest("p").text(),unique:b(d).attr("data-unique"),video_id:m.prototype.getYoutubeId(e)})});b(l.VIDEOS_FIELD).val(JSON.stringify(a));m.prototype.printVideos(a);b(l.CANCEL_BUTTON).trigger("click")};m.prototype.clearAllData=function(){b(l.VIDEOS_FIELD).val("[]");b(l.PREVIEW_CONTAINER).html("")};m.prototype.resetModal=function(){m.prototype.clearAllData();m.prototype.printTocs()};i.register(m.TYPE,m,"mod_lanebs/modal_video");return m});
//# sourceMappingURL=modal_video.min.js.map
