define ("mod_lanebs/modal_video",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/modal","core/custom_interaction_events","core/modal_registry","mod_lanebs/modal_player_handle","core/str"],function(a,b,c,d,e,f,g,h,i,j){var k={SUBMIT_BUTTON:"[data-action='submit_button']",OPEN_BUTTON:"#id_modal_video_button",OPEN_BUTTON_CONTAINER:"#id_modal_video_button",CANCEL_BUTTON:"[data-action='close_button']",CONTENT_BLOCK:"[data-action='video_content_block']",CLOSE_CROSS:".close",ROOT_MODAL:"[data-region='modal-container']",DATA_TOC:"#data-toc",BOOK_ID_SELECTOR:"[name='content']",SEARCH_CLASS:".modal_video",VIDEOS_FIELD:"input[name='videos']",DELETE_SELECTED:"span.closes",PREVIEW_CLASS:".video-item",PREVIEW_TEXT:"span.video_preview",PREVIEW_CONTAINER:".video_preview_container",TRIGGER_PLAYER:"img.modal_video",PLAY_BUTTON_HOVER:".video_play_hover"},l=function(a){g.call(this,a);l.prototype.modal=this;this.printTocs()};l.TYPE="mod_lanebs-video";l.CONTENT_BLOCK=k.CONTENT_BLOCK;l.prototype=Object.create(g.prototype);l.prototype.constructor=l;l.prototype.registerEventListeners=function(){g.prototype.registerEventListeners.call(this);this.getModal().on(h.events.activate,k.SUBMIT_BUTTON,l.prototype.updateVideoField);this.getRoot().on(h.events.activate,k.CANCEL_BUTTON+", "+k.CLOSE_CROSS,function(){this.destroy();this.getBackdrop().then(function(a){a.hide()})}.bind(this))};l.prototype.printTocs=function(){var a=b(k.BOOK_ID_SELECTOR).val();if(""!==a){l.prototype.getAjaxCall("mod_lanebs_toc_name",{id:a,page:0},function(a){var c={id:b(k.BOOK_ID_SELECTOR).val()};l.prototype.getAjaxCall("mod_lanebs_toc_videos",c,function(c){var d=l.prototype.modal.getBody(),e="",f=[],g={};if(a){a.forEach(function(a,d){var h="<ul class=\"modal_video\">",i=a.page;f[d]=!1;var j;try{c.forEach(function(a){if(a.start_page===i){f[d]=!0;j=a.unique_id+"_"+d;h+="<li class=\"modal_video\"><label for=\"video_"+j+"\" class=\"modal_video\"><p class=\"modal_video\"><input type=\"checkbox\" data-unique=\""+j+"\" class=\"modal_video\" id=\"video_"+j+"\" data-url=\""+a.link_url+"\" />"+a.link_name+"</p><img src=\""+l.prototype.getYoutubePreview(a.link_url)+"\" alt=\""+a.link_name+"\" class=\"modal_video\" data-id=\""+l.prototype.getYoutubeId(a.link_url)+"\" /><div class=\"video_play_hover\"></div></label></li>"}else if("-1"===a.start_page){f[d]=void 0;b(k.OPEN_BUTTON_CONTAINER).closest(".form-group").addClass("hidden");throw g}})}catch(a){if(a!==g)throw a}h+="</ul>";if(!0===f[d]){e+="<div class=\"item-toc\" style=\"margin-bottom:10px;\" data-page=\""+i+"\"><span>"+a.title+", "+l.prototype.strings.lanebs_read_pg+". "+a.page+"</span><br><a class=\"\" data-toggle=\"collapse\" href=\"#collapseDescription_"+i+"_"+d+"\" role=\"button\">\u0412\u0438\u0434\u0435\u043E-\u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0430\u0446\u0438\u0438</a><div class=\"collapse\" id=\"collapseDescription_"+i+"_"+d+"\">"+h+"</div></div>"}})}if(f[0]!==void 0){b(k.OPEN_BUTTON_CONTAINER).closest(".form-group").removeClass("hidden");d.find(k.DATA_TOC).html(e);b(d.find(k.TRIGGER_PLAYER)).on("click",function(a){var c=b(a.target).attr("data-id");j.init(a,c)});b(d.find(k.PLAY_BUTTON_HOVER)).on("click",function(a){a.preventDefault();a.stopPropagation();b(a.currentTarget).siblings(k.TRIGGER_PLAYER).trigger("click")})}var h=l.prototype.getIssetVideos();if(h){l.prototype.printVideos(h);l.prototype.preCheckVideos(h)}})})}};l.prototype.getAjaxCall=function(a,b,d){return c.call([{methodname:a,args:b}])[0].then(function(a){return a}).done(function(a){d(JSON.parse(a.body));return!0}).fail(function(a){console.log(a);return!1})};l.prototype.printVideos=function(a){var c="<div class=\"col-md-3\"></div><div class=\"container col-md-9\">";a.forEach(function(a){c+="<div class=\"item video-item row\"><div class=\"img-wraps\"><span class=\"closes\" title=\"Delete\" data-unique=\""+a.unique+"\">\xD7</span><img width=\"100px;\" height=\"100px;\" src=\""+l.prototype.getYoutubePreview(a.link)+"\" alt=\""+a.name+"\"  class=\"img-responsive\" src=\"images/image.jpg\" data-id=\""+l.prototype.getYoutubeId(a.link)+"\"/></div><span class=\"video_preview\">"+a.name+"</span></div>"});c+="</div>";b(k.PREVIEW_CONTAINER).html(c);l.prototype.deleteSelectedEvent()};l.prototype.getYoutubeId=function(a){var b=a.split("?")[1];return new URLSearchParams(b).get("v")};l.prototype.getYoutubePreview=function(a){var b=l.prototype.getYoutubeId(a);return"https://img.youtube.com/vi/"+b+"/0.jpg"};l.prototype.getIssetVideos=function(){var a=b(k.VIDEOS_FIELD).val();try{return JSON.parse(a)}catch(a){console.log(a.message);return""}};l.prototype.preCheckVideos=function(a){a.forEach(function(a){l.prototype.modal.getBody().find("input[data-unique=\""+a.unique+"\"]").trigger("click")})};l.prototype.deleteSelectedEvent=function(){b(k.DELETE_SELECTED).each(function(a,c){b(c).on("click",function(a){var c=b(a.target).closest(k.PREVIEW_CLASS),d=b(a.target).attr("data-unique");l.prototype.modal.getBody().find("input[data-unique=\""+d+"\"]").trigger("click");b(c).remove();l.prototype.updateVideoField()})})};l.prototype.updateVideoField=function(){var a=[],c=l.prototype.modal.getBody().find("ul"+k.SEARCH_CLASS+" input:checked");c.each(function(c,d){var e=b(d).attr("data-url");a.push({link:e,name:b(d).closest("p").text(),unique:b(d).attr("data-unique"),video_id:l.prototype.getYoutubeId(e)})});b(k.VIDEOS_FIELD).val(JSON.stringify(a));l.prototype.printVideos(a);b(k.CANCEL_BUTTON).trigger("click")};l.prototype.clearAllData=function(){b(k.VIDEOS_FIELD).val("[]");b(k.PREVIEW_CONTAINER).html("")};l.prototype.resetModal=function(){l.prototype.clearAllData();l.prototype.printTocs()};i.register(l.TYPE,l,"mod_lanebs/modal_video");return l});
//# sourceMappingURL=modal_video.min.js.map
